<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Class: PhpConfig</title>

  <link rel="stylesheet" href="./rdoc.css" type="text/css" media="screen" />

  <script src="./js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="./js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="./js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="./js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="./index.html">Home</a>
          <a href="./index.html#classes">Classes</a>
          <a href="./index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="./php_config_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="php_config.rb">php_config.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link">Object</p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-new">::new</a></li>
          
          <li><a href="#method-i-keys">#keys</a></li>
          
          <li><a href="#method-i-line">#line</a></li>
          
          <li><a href="#method-i-save">#save</a></li>
          
          <li><a href="#method-i-set">#set</a></li>
          
          <li><a href="#method-i-value">#value</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="./Gemfile.html">Gemfile</a></li>
        
          <li class="file"><a href="./Rakefile.html">Rakefile</a></li>
        
          <li class="file"><a href="./screenshots/Readme_txt.html">Readme.txt</a></li>
        
          <li class="file"><a href="./test/reports/Readme_txt.html">Readme.txt</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="./images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="./ApplicationTest.html">ApplicationTest</a></li>
        
          <li><a href="./OS.html">OS</a></li>
        
          <li><a href="./PhpConfig.html">PhpConfig</a></li>
        
          <li><a href="./TestInternational.html">TestInternational</a></li>
        
          <li><a href="./TestTemplate.html">TestTemplate</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">PhpConfig</h1>

    <div id="description" class="description">
      
<p>Class to read and edit a PHP file considered as a configuration file</p>

<p>The goal of this class is to edit these configuration files while
preserving comments and formating. Formatting preservation is a best
effort. The goal is to prevent the configuration editor to remove all
comments and formatting, not to guarantee that all indentation is stricly
preserve whatever it is.</p>

<p>These files contain:</p>

<pre>* &lt;?php open directive
* multiline comments started by /** and ended by */
* blank lines
* scalar string values:  $config['key'] = &quot;string value&quot;;
* scalar string values:  $config['key'] = 'string value';
* scalar boolean values: $config['key'] = TRUE;
* scalar boolean values: $config['key'] = FALSE;
* scalar integer values: $config['key'] = 10;
* scalar decimal values: $config['key'] = 10.314;
* PHP statements: if ( ! defined('BASEPATH')) exit('No direct script access allowed');</pre>

<p>Use cases</p>

<pre>    * load a configuration file
* get the list of keys
* get the value for a key, scalar or array
* change the value for a key, scalar or array
* save the configuration</pre>

<p>Design</p>

<pre>Exact PHP grammar parser (no, too complex and too expensive)
or
search for configuration element definition outside of comments.

The second approach is not full proof. Eventually the parser could detect
the start of a configuration element where there is none, or miss some because
of a weird formating.</pre>

    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="new-method" class="method-detail ">
          <a name="method-c-new"></a>

          
          <div class="method-heading">
            <span class="method-name">new</span><span
              class="method-args">(filename, config_pattern = "config")</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="new-source">
<pre>
<span class="ruby-comment"># File php_config.rb, line 62</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">config_pattern</span> = <span class="ruby-string">&quot;config&quot;</span>)
  <span class="ruby-ivar">@filename</span> = <span class="ruby-identifier">filename</span>
  <span class="ruby-ivar">@config_pattern</span> = <span class="ruby-identifier">config_pattern</span>
  <span class="ruby-ivar">@values</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@start_of</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@keys</span> = []
  
  <span class="ruby-comment"># Regular expressions used by the parser</span>
  <span class="ruby-identifier">reg_comment_line1</span> = <span class="ruby-regexp">/^\s*\/\//</span>
  <span class="ruby-identifier">reg_comment_line2</span> = <span class="ruby-regexp">/^\s*\#/</span>
  <span class="ruby-identifier">reg_comment_line3</span> = <span class="ruby-regexp">/^\s*\/\*.*\*\//</span>
  <span class="ruby-identifier">reg_comment_line</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">union</span>(<span class="ruby-identifier">reg_comment_line1</span>, <span class="ruby-identifier">reg_comment_line2</span>, <span class="ruby-identifier">reg_comment_line3</span>)

  <span class="ruby-identifier">reg_comment_start</span> = <span class="ruby-regexp">/^\s*\/\*/</span>
  <span class="ruby-identifier">reg_comment_stop</span> = <span class="ruby-regexp">/^.*\*\//</span>
  
  <span class="ruby-identifier">reg_single_line_config</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span> <span class="ruby-node">&quot;^[[:blank:]]*\\\$#{@config_pattern}\\\[(.*)\\\][[:blank:]]*=[[:blank:]]*(.*);&quot;</span>
  
  <span class="ruby-identifier">cnt</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">state</span> = <span class="ruby-value">:statements</span>
  <span class="ruby-ivar">@lines</span> = []
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">readlines</span>(<span class="ruby-identifier">filename</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
    
    <span class="ruby-ivar">@lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">line</span>
    <span class="ruby-comment"># Either I look for patterns and treat them depending on the state</span>
    <span class="ruby-comment"># Or I look for different patterns in every state</span>
    
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">line</span>
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">reg_comment_line</span>
        <span class="ruby-comment"># puts &quot;#{cnt}: ### comment line #{line}&quot;</span>
        
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">reg_comment_start</span>
        <span class="ruby-comment"># puts &quot;#{cnt}: ### start of comment #{line}&quot;</span>
        <span class="ruby-identifier">state</span> = <span class="ruby-value">:comments</span>
 
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">reg_comment_stop</span>
        <span class="ruby-comment"># puts &quot;#{cnt}: ### end of comment #{line}&quot;</span>
        <span class="ruby-identifier">state</span> = <span class="ruby-value">:statements</span>
        
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">reg_single_line_config</span>
        <span class="ruby-identifier">key</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">tr</span>(<span class="ruby-string">'&quot;'</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">tr</span>(<span class="ruby-string">&quot;'&quot;</span>, <span class="ruby-string">''</span>)
        <span class="ruby-identifier">value</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>(<span class="ruby-value">2</span>)
        <span class="ruby-comment"># puts &quot;#{cnt}: CONFIG STATEMENT #{line}&quot;</span>
        <span class="ruby-comment"># puts &quot;last match = \&quot;#{Regexp.last_match}\&quot;&quot;</span>
        <span class="ruby-comment"># puts &quot;key = \&quot;#{key}\&quot;&quot;</span>
        <span class="ruby-comment"># puts &quot;value = \&quot;#{value}\&quot;&quot;</span>
        <span class="ruby-ivar">@values</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">value</span>
        <span class="ruby-ivar">@start_of</span>[<span class="ruby-identifier">cnt</span>] = <span class="ruby-identifier">key</span>
        <span class="ruby-ivar">@keys</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">key</span>

    <span class="ruby-keyword">else</span>
      
      <span class="ruby-keyword">if</span> (<span class="ruby-identifier">state</span> <span class="ruby-operator">==</span> <span class="ruby-value">:comments</span>)
        <span class="ruby-comment"># puts &quot;#{cnt}: ### #{line}&quot;</span>
      <span class="ruby-keyword">else</span> 
        <span class="ruby-comment"># puts &quot;#{cnt}: no match #{line}&quot;          </span>
      <span class="ruby-keyword">end</span>   
    <span class="ruby-keyword">end</span>
    
    <span class="ruby-identifier">cnt</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- new-source -->
            
          </div>

          

          
        </div><!-- new-method -->

      
      </div><!-- public-class-method-details -->
    
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="keys-method" class="method-detail ">
          <a name="method-i-keys"></a>

          
          <div class="method-heading">
            <span class="method-name">keys</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Return the list of keys found in the configuration file</p>
            

            
            <div class="method-source-code" id="keys-source">
<pre>
<span class="ruby-comment"># File php_config.rb, line 156</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">keys</span>
  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@keys</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- keys-source -->
            
          </div>

          

          
        </div><!-- keys-method -->

      
        <div id="line-method" class="method-detail ">
          <a name="method-i-line"></a>

          
          <div class="method-heading">
            <span class="method-name">line</span><span
              class="method-args">(nb)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Return a line Params:</p>
<table class="rdoc-list"><tr><td class="rdoc-term"><p><tt>nb</tt></p></td>
<td>
<p>line index</p>
</td></tr></table>
            

            
            <div class="method-source-code" id="line-source">
<pre>
<span class="ruby-comment"># File php_config.rb, line 184</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">line</span>(<span class="ruby-identifier">nb</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@lines</span>[<span class="ruby-identifier">nb</span>]
<span class="ruby-keyword">end</span></pre>
            </div><!-- line-source -->
            
          </div>

          

          
        </div><!-- line-method -->

      
        <div id="save-method" class="method-detail ">
          <a name="method-i-save"></a>

          
          <div class="method-heading">
            <span class="method-name">save</span><span
              class="method-args">(filename = "")</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Save the configuration Params:</p>
<table class="rdoc-list"><tr><td class="rdoc-term"><p><tt>filename</tt></p></td>
<td>
<p>if present, name of the file to save. If not save in the file used to open</p>
</td></tr></table>
            

            
            <div class="method-source-code" id="save-source">
<pre>
<span class="ruby-comment"># File php_config.rb, line 130</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save</span>(<span class="ruby-identifier">filename</span> = <span class="ruby-string">&quot;&quot;</span>)
  <span class="ruby-identifier">filename</span> = <span class="ruby-ivar">@filename</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">filename</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-string">&quot;w&quot;</span>)
    <span class="ruby-identifier">cnt</span> = <span class="ruby-value">0</span>
    <span class="ruby-ivar">@lines</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">key</span> = <span class="ruby-ivar">@start_of</span>[<span class="ruby-identifier">cnt</span>]
      <span class="ruby-keyword">if</span> (<span class="ruby-identifier">key</span>)
        <span class="ruby-identifier">str</span> = <span class="ruby-node">&quot;$#{@config_pattern}['#{key}'] = #{self.value(key)};\n&quot;</span>
        <span class="ruby-identifier">file</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">str</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">file</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">line</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">cnt</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> 
    <span class="ruby-keyword">end</span>
    
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">IOError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-comment">#some error occur, dir not writable etc.</span>
  <span class="ruby-keyword">ensure</span>
    <span class="ruby-identifier">file</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- save-source -->
            
          </div>

          

          
        </div><!-- save-method -->

      
        <div id="set-method" class="method-detail ">
          <a name="method-i-set"></a>

          
          <div class="method-heading">
            <span class="method-name">set</span><span
              class="method-args">(key, value)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Set the value of a key Params:</p>
<table class="rdoc-list"><tr><td class="rdoc-term"><p><tt>key</tt></p></td>
<td></td></tr><tr><td class="rdoc-term"><p><tt>value</tt></p></td>
<td>
<p>scalar or array</p>
</td></tr></table>
            

            
            <div class="method-source-code" id="set-source">
<pre>
<span class="ruby-comment"># File php_config.rb, line 175</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-ivar">@values</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">value</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- set-source -->
            
          </div>

          

          
        </div><!-- set-method -->

      
        <div id="value-method" class="method-detail ">
          <a name="method-i-value"></a>

          
          <div class="method-heading">
            <span class="method-name">value</span><span
              class="method-args">(key)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Get the value of a key Params:</p>
<table class="rdoc-list"><tr><td class="rdoc-term"><p><tt>key</tt></p></td>
<td></td></tr></table>
            

            
            <div class="method-source-code" id="value-source">
<pre>
<span class="ruby-comment"># File php_config.rb, line 165</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">value</span>(<span class="ruby-identifier">key</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@values</span>[<span class="ruby-identifier">key</span>]
<span class="ruby-keyword">end</span></pre>
            </div><!-- value-source -->
            
          </div>

          

          
        </div><!-- value-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

